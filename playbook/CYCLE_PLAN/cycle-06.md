# 実装サイクル計画（Cycle 6 / 1〜2日）

## 期間
- （例）2026/02/12 〜 2026/02/13

## 今回のテーマ
- 日記ごとの要約が「冒頭切り取り」になっているため、全文を把握して“それっぽい要約”を返せるようにする（ルールベース強化）
- 外部送信なし・依存追加なしで実現する（端末差に強い）

## ゴール（ユーザー体感）
- 長文でも「冒頭だけ」ではなく、内容全体を反映した要約になる
- 短文でも不自然にならない
- 既存機能（作成/編集/削除/検索/PWA/エクスポート/暗号化バックアップ）が壊れない

## やらないこと
- WebGPU/ブラウザ内LLMの本格導入（オプション化は次以降）
- 外部API送信
- 感情推定（タグの自動付与）
- 週/月要約
- 新しい依存ライブラリ追加

## 仕様（最小）
### 要約生成の方針
- 入力：Entry.body（全文）
- 出力：1〜3文（合計文字数上限あり）
- 方式：文分割 → 文スコアリング → 上位文抽出 → 軽い重複回避 → 結合

### 文分割（ラフでOK）
- 区切り候補：`。` `！` `？` 改行
- 空行は段落境界として扱う（段落先頭文の加点に使う）

### スコアリング（加点方式の例）
- 文長が適度（短すぎ/長すぎは減点）
- “意思/感情/予定/振り返り”系の語を含むと加点（例：思う/感じる/決めた/不安/嬉しい/疲れた/反省/改善/明日/予定 など）
- 数字/時刻/固有名詞っぽい要素があれば加点（例：`2026` `19:30` `AWS` など）
- 段落先頭文は少し加点（ただし冒頭固定にならないよう控えめ）

### 重複回避（軽く）
- すでに選んだ文と単語の重なりが大きい文はスキップ（ゆるい判定でOK）

### 文字数上限
- 合計 140〜220文字程度を目安（超える場合は文数を減らす/文を短くする）

## 変更対象（想定）
- `src/llm/rule-based.ts`（または同等のルール要約実装）
- 必要なら `src/domain/summary.ts` 等に純関数を切り出してもよい
- UI/DBの仕様は変更しない（summaryStatusフロー維持）

## 受け入れ条件（DoD）
- [ ] 長文（5段落以上）で、冒頭以外の内容も反映される
- [ ] 短文（1〜2文）でも壊れない
- [ ] 要約ON/OFFの挙動は維持（OFFなら要約を作らない）
- [ ] オフライン動作のまま
- [ ] 本文・要約をconsole.logに出していない
- [ ] 既存のexport/import/暗号化export/import後も要約生成が動く（または再生成できる）